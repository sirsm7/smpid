<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SMPID - Portal Sekolah</title>
  
  <meta name="theme-color" content="#16a34a">
  <link rel="icon" href="icoppdag.png">
  
  <!-- TAILWIND CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FONTAWESOME -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            brand: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 900: '#14532d' },
            ppd: { 50: '#f3e8ff', 100: '#e9d5ff', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9' }
          },
          animation: {
            'fade-up': 'fadeUp 0.5s ease-out forwards',
          },
          keyframes: {
            fadeUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    .hidden { display: none !important; }
    .uppercase-input { text-transform: uppercase; }
    
    /* Global Table Wrapping Fix */
    table td, table th {
      white-space: normal !important;
      word-wrap: break-word !important;
      overflow-wrap: break-word !important;
      vertical-align: middle;
    }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>

  <!-- Library JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body id="page-user" class="bg-slate-50 text-slate-800 antialiased min-h-screen flex flex-col">

  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm">
    <div class="text-center text-white">
      <i class="fas fa-circle-notch fa-spin fa-3x mb-3 text-brand-500"></i>
      <p class="font-bold tracking-wide animate-pulse">Memproses...</p>
    </div>
  </div>

  <!-- HEADER HERO -->
  <header class="bg-gradient-to-br from-brand-900 via-brand-700 to-emerald-900 pb-20 pt-8 px-4 shadow-xl text-center relative overflow-hidden">
    <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none"></div>
    
    <div class="relative z-10 max-w-4xl mx-auto">
        <!-- Logo PPD: Memperbesarkan saiz kepada w-40 (Optimum Prominent Size V11.0) -->
        <img src="icoppdag.png" alt="Logo PPD" class="w-40 h-auto mx-auto mb-3 drop-shadow-md">
        <h1 class="text-xl md:text-2xl font-bold text-white mb-1 tracking-tight" id="dispNamaSekolah">MEMUATKAN DATA...</h1>
        <p class="text-emerald-200 text-xs font-bold uppercase tracking-wider mb-4" id="dispKodDaerah">KOD: - | DAERAH: -</p>
        
        <span class="inline-flex items-center gap-2 bg-white/10 border border-white/20 text-white text-xs font-bold px-4 py-1.5 rounded-full backdrop-blur-sm" id="displayKodSekolah">
            <i class="fas fa-spinner fa-spin"></i> Sila Tunggu
        </span>
    </div>
  </header>

  <!-- MAIN CONTAINER -->
  <div class="container mx-auto px-4 -mt-12 pb-20 relative z-20 max-w-4xl">

    <!-- MENU UTAMA -->
    <div id="section-menu" class="animate-fade-up">
        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
            <div class="p-6 md:p-8">
                <div class="text-center mb-8">
                    <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest border-b border-slate-100 pb-4" id="welcomeText">MENU UTAMA</h2>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                    <!-- PROFIL SEKOLAH -->
                    <a href="#profil" onclick="showSection('profil', event)" class="group p-4 bg-blue-50 hover:bg-blue-600 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-blue-100 hover:shadow-lg hover:shadow-blue-500/30">
                        <div class="w-12 h-12 bg-white text-blue-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-blue-600">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <span class="text-xs font-bold text-blue-800 group-hover:text-white uppercase">PROFIL SEKOLAH</span>
                    </a>

                    <!-- HELPDESK & ADUAN -->
                    <a href="#aduan" onclick="showSection('aduan', event)" class="group p-4 bg-red-50 hover:bg-red-500 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-red-100 hover:shadow-lg hover:shadow-red-500/30">
                        <div class="w-12 h-12 bg-white text-red-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-red-600">
                            <i class="fas fa-headset"></i>
                        </div>
                        <span class="text-xs font-bold text-red-800 group-hover:text-white uppercase">HELPDESK & ADUAN</span>
                    </a>

                    <!-- LAPORAN PPPDM -->
                    <a href="modules/pppdm/index.html" class="group p-4 bg-emerald-50 hover:bg-emerald-600 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-emerald-100 hover:shadow-lg hover:shadow-emerald-500/30">
                        <div class="w-12 h-12 bg-white text-emerald-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-emerald-600">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span class="text-xs font-bold text-emerald-800 group-hover:text-white uppercase">LAPORAN PPPDM</span>
                    </a>

                    <!-- BELAJAR AI -->
                    <a href="modules/spka/index.html" class="group p-4 bg-indigo-50 hover:bg-indigo-600 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-indigo-100 hover:shadow-lg hover:shadow-indigo-500/30">
                        <div class="w-12 h-12 bg-white text-indigo-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-indigo-600">
                            <i class="fas fa-robot"></i>
                        </div>
                        <span class="text-xs font-bold text-indigo-800 group-hover:text-white uppercase">BELAJAR AI</span>
                    </a>

                    <!-- ANALISA DIGITAL -->
                    <a href="#analisa" onclick="showSection('analisa', event)" class="group p-4 bg-amber-50 hover:bg-amber-500 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-amber-100 hover:shadow-lg hover:shadow-amber-500/30">
                        <div class="w-12 h-12 bg-white text-amber-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-amber-600">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <span class="text-xs font-bold text-amber-800 group-hover:text-white uppercase">ANALISA DIGITAL</span>
                    </a>

                    <!-- PENSIJILAN GOOGLE -->
                    <a href="modules/bankgemini/index.html" class="group p-4 bg-purple-50 hover:bg-purple-600 rounded-2xl transition-all duration-300 transform hover:-translate-y-1 text-center border border-purple-100 hover:shadow-lg hover:shadow-purple-500/30">
                        <div class="w-12 h-12 bg-white text-purple-500 rounded-full flex items-center justify-center text-xl mb-3 mx-auto shadow-sm group-hover:text-purple-600">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <span class="text-xs font-bold text-purple-800 group-hover:text-white uppercase">PENSIJILAN GOOGLE</span>
                    </a>
                </div>

                <div class="space-y-3">
                    <a href="#pencapaian" onclick="showSection('pencapaian', event)" class="w-full py-4 bg-teal-600 hover:bg-teal-700 text-white rounded-xl font-bold shadow-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-trophy text-yellow-300"></i> Rekod Pencapaian & Kemenjadian
                    </a>
                    <button onclick="ubahKataLaluan()" class="w-full py-3 bg-white border-2 border-slate-200 hover:border-slate-400 text-slate-600 rounded-xl font-bold transition flex items-center justify-center gap-2 text-sm">
                        <i class="fas fa-key text-slate-400"></i> Tukar Kata Laluan
                    </button>
                    <button id="btnLogoutMenu" onclick="keluarSistem()" class="w-full py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-bold transition flex items-center justify-center gap-2 text-sm">
                        <i class="fas fa-sign-out-alt"></i> Log Keluar
                    </button>
                </div>

                <div class="text-center mt-6">
                     <button id="btnResetData" onclick="resetDataSekolah()" class="text-xs text-red-400 hover:text-red-600 font-bold hidden"><i class="fas fa-trash-alt mr-1"></i> [Admin] Reset Data Sekolah Ini</button>
                </div>
            </div>
            <div class="bg-slate-50 p-3 text-center border-t border-slate-100">
                <p class="text-[10px] text-slate-400 font-medium">&copy; Unit Sumber Teknologi Pendidikan PPDAG</p>
            </div>
        </div>
    </div>

    <!-- SEKSYEN PROFIL -->
    <div id="section-profil" class="hidden animate-fade-up">
        <div class="flex items-center mb-6">
            <button onclick="showSection('menu', event)" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-600 hover:bg-slate-50 mr-4 transition"><i class="fas fa-arrow-left"></i></button>
            <h2 class="text-xl font-bold text-slate-800">Kemaskini Maklumat</h2>
        </div>

        <div class="bg-white rounded-3xl shadow-lg border border-slate-100 p-6 md:p-8">
            <form id="dataForm" onsubmit="event.preventDefault(); simpanProfil();" class="space-y-6">
                <input type="hidden" id="hiddenKodSekolah">
                
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                    <h3 class="text-sm font-bold text-blue-700 uppercase mb-4 flex items-center gap-2"><i class="fas fa-laptop-code"></i> MAKLUMAT GPICT</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-blue-500 uppercase mb-1">NAMA PENUH</label>
                            <input type="text" id="gpictNama" class="w-full p-3 rounded-xl border border-blue-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none uppercase-input font-bold" required oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-blue-500 uppercase mb-1">NO TELEFON</label>
                                <input type="tel" id="gpictTel" class="w-full p-3 rounded-xl border border-blue-200 focus:border-blue-500 outline-none" required oninput="autoFormatPhone(this)">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-blue-500 uppercase mb-1">EMEL DELIMA</label>
                                <input type="email" id="gpictEmel" class="w-full p-3 rounded-xl border border-blue-200 focus:border-blue-500 outline-none" required>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-emerald-700 uppercase flex items-center gap-2"><i class="fas fa-user-shield"></i> ADMIN DELIMA</h3>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="checkSama" onchange="salinData()" class="w-4 h-4 accent-emerald-500">
                            <span class="text-xs font-bold text-emerald-600">SAMA?</span>
                        </label>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-emerald-500 uppercase mb-1">NAMA PENUH</label>
                            <input type="text" id="adminNama" class="w-full p-3 rounded-xl border border-emerald-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 outline-none uppercase-input font-bold" required oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-emerald-500 uppercase mb-1">NO TELEFON</label>
                                <input type="tel" id="adminTel" class="w-full p-3 rounded-xl border border-emerald-200 focus:border-emerald-500 outline-none" required oninput="autoFormatPhone(this)">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-emerald-500 uppercase mb-1">EMEL DELIMA</label>
                                <input type="email" id="adminEmel" class="w-full p-3 rounded-xl border border-emerald-200 focus:border-emerald-500 outline-none" required>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                    <i class="fas fa-save"></i> SIMPAN MAKLUMAT
                </button>
            </form>
        </div>
    </div>

    <!-- SEKSYEN ANALISA -->
    <div id="section-analisa" class="hidden animate-fade-up">
        <div class="flex items-center mb-6">
            <button onclick="showSection('menu', event)" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-600 hover:bg-slate-50 mr-4 transition"><i class="fas fa-arrow-left"></i></button>
            <h2 class="text-xl font-bold text-slate-800">Analisa Digital</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500 to-blue-700 rounded-3xl p-6 text-white shadow-lg shadow-blue-500/20">
                <p class="text-xs font-bold text-blue-200 uppercase mb-1">Skor DCS</p>
                <h2 class="text-4xl font-black mb-2" id="valDcs">-</h2>
                <span class="inline-block bg-white/20 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm" id="trendDcs">Memuatkan...</span>
            </div>
            <div class="bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-3xl p-6 text-white shadow-lg shadow-emerald-500/20">
                <p class="text-xs font-bold text-emerald-200 uppercase mb-1">% Aktif DELIMa</p>
                <h2 class="text-4xl font-black mb-2"><span id="valAktif">-</span>%</h2>
                <span class="inline-block bg-white/20 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm">Tahun Semasa</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <a href="https://app.powerbi.com/view?r=eyJrIjoiNWRmOGRhYTgtNWU3Mi00ZDI5LTkyZDctNWQ5ZjYyN2JiNjNiIiwidCI6ImU5N2QwMDA1LTcyZTQtNGM3YS1hOWMwLThmOWZkZWY1ZmY2OCIsImMiOjEwfQ%3D%3D" target="_blank" class="bg-white border-2 border-blue-100 hover:border-blue-500 text-blue-600 p-4 rounded-2xl font-bold text-sm text-center transition">
                <i class="fas fa-globe mr-2"></i> Analisa Kebangsaan
            </a>
            <a href="https://app.powerbi.com/view?r=eyJrIjoiNzUyYzQ5ZTItZmU0Yi00Y2ZlLTg2OTMtYjYwOTk4NDRlYzA4IiwidCI6ImQ3M2UwNDFkLWE2MzAtNDg5NS05NmZlLWRiMGUxZTc0Y2Y5OCIsImMiOjEwfQ%3D%3D" target="_blank" class="bg-white border-2 border-red-100 hover:border-red-500 text-red-600 p-4 rounded-2xl font-bold text-sm text-center transition">
                <i class="fas fa-chart-bar mr-2"></i> Analisa Penggunaan
            </a>
        </div>

        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 mb-6">
            <h3 class="text-sm font-bold text-slate-500 uppercase mb-4">Trend Pencapaian</h3>
            <div class="relative h-64 w-full">
                <canvas id="chartAnalisa"></canvas>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <table class="w-full text-sm text-left">
                <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                    <tr><th class="px-6 py-3 font-bold">Tahun</th><th class="px-6 py-3 font-bold">Skor DCS</th><th class="px-6 py-3 font-bold">% Aktif</th></tr>
                </thead>
                <tbody id="tableAnalisaBody" class="divide-y divide-slate-100"><tr><td colspan="3" class="p-6 text-center text-slate-400">Memuatkan data...</td></tr></tbody>
            </table>
        </div>
    </div>

    <!-- SEKSYEN PENCAPAIAN -->
    <div id="section-pencapaian" class="hidden animate-fade-up">
        <div class="flex items-center mb-6">
            <button onclick="showSection('menu', event)" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-600 hover:bg-slate-50 mr-4 transition"><i class="fas fa-arrow-left"></i></button>
            <h2 class="text-xl font-bold text-slate-800">Rekod Pencapaian</h2>
        </div>

        <div class="flex bg-white p-1 rounded-xl shadow-sm border border-slate-100 mb-6" id="pencapaianTabs">
            <button id="tab-p-murid" class="flex-1 py-2 rounded-lg text-xs font-bold bg-teal-600 text-white shadow-sm transition" onclick="setPencapaianType('MURID')">MURID</button>
            <button id="tab-p-guru" class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-50 transition" onclick="setPencapaianType('GURU')">GURU</button>
            <button id="tab-p-sekolah" class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-50 transition" onclick="setPencapaianType('SEKOLAH')">SEKOLAH</button>
        </div>

        <div id="wrapperJenisRekod" class="flex justify-center gap-4 mb-6 hidden">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="radioJenis" id="radioPertandingan" class="accent-teal-600" checked onchange="toggleJenisPencapaian()">
                <span class="text-xs font-bold">PERTANDINGAN</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="radioJenis" id="radioPensijilan" class="accent-teal-600" onchange="toggleJenisPencapaian()">
                <span class="text-xs font-bold">PENSIJILAN</span>
            </label>
        </div>

        <div class="bg-white rounded-3xl shadow-lg border border-slate-100 p-6 md:p-8 mb-8 border-t-4 border-t-teal-500">
            <h3 class="text-sm font-bold text-teal-700 uppercase mb-6 flex items-center gap-2"><i class="fas fa-plus-circle"></i> ISI MAKLUMAT PENCAPAIAN</h3>
            <form id="formPencapaian" onsubmit="event.preventDefault(); simpanPencapaian();" class="space-y-5">
                <input type="hidden" id="pencapaianKategori" value="MURID">
                <input type="hidden" id="pInputJenisRekod" value="PERTANDINGAN">

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="labelNamaPeserta">NAMA MURID / KUMPULAN</label>
                    <input type="text" id="pInputNama" class="w-full p-3 rounded-xl border border-slate-300 focus:border-teal-500 outline-none uppercase-input font-bold" required oninput="this.value = this.value.toUpperCase()">
                </div>

                <div id="divInputJawatan" class="hidden">
                    <label class="block text-xs font-bold text-amber-600 uppercase mb-1">JAWATAN (WAJIB)</label>
                    <select id="pInputJawatan" class="w-full p-3 rounded-xl bg-amber-50 border border-amber-200 text-slate-700 font-bold outline-none">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div id="divInputPenyedia" class="hidden">
                    <label class="block text-xs font-bold text-amber-600 uppercase mb-1">PENYEDIA / JENAMA</label>
                    <select id="pInputPenyedia" class="w-full p-3 rounded-xl bg-white border border-slate-300 text-slate-700 font-bold outline-none">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="lblProgram">NAMA PERTANDINGAN</label>
                    <input type="text" id="pInputProgram" class="w-full p-3 rounded-xl border border-slate-300 focus:border-teal-500 outline-none uppercase-input" required oninput="this.value = this.value.toUpperCase()">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div id="divColPeringkat">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PERINGKAT TERTINGGI</label>
                        <select id="pInputPeringkat" class="w-full p-3 rounded-xl bg-white border border-slate-300 outline-none">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div id="divColTahun">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">TAHUN ACARA</label>
                        <div class="relative">
                            <select id="pInputTahun" class="w-full p-3 rounded-xl border border-slate-300 font-bold appearance-none bg-white outline-none" required>
                                <!-- Populated by JS -->
                            </select>
                            <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none"></i>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="lblPencapaian">KEPUTUSAN / PENCAPAIAN</label>
                    <input type="text" id="pInputPencapaian" class="w-full p-3 rounded-xl border border-slate-300 focus:border-teal-500 outline-none uppercase-input" required oninput="this.value = this.value.toUpperCase()">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PAUTAN BUKTI (GOOGLE DRIVE)</label>
                    <input type="url" id="pInputLink" class="w-full p-3 rounded-xl border border-slate-300 focus:border-teal-500 outline-none text-blue-600" required placeholder="https://drive.google.com/...">
                </div>

                <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                    <i class="fas fa-save"></i> SIMPAN REKOD
                </button>
            </form>
        </div>

        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-xs font-bold text-slate-500 uppercase">SENARAI REKOD TERDAHULU</h3>
                <button onclick="loadPencapaianSekolah()" class="text-xs bg-white border border-slate-200 px-3 py-1 rounded hover:bg-slate-50 transition"><i class="fas fa-sync-alt"></i></button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                        <tr><th class="px-6 py-3 font-bold text-center">KATEGORI</th><th class="px-6 py-3 font-bold">BUTIRAN PERTANDINGAN</th><th class="px-6 py-3 font-bold text-center">TINDAKAN</th></tr>
                    </thead>
                    <tbody id="tbodyRekodPencapaian" class="divide-y divide-slate-100"><tr><td colspan="3" class="p-6 text-center text-slate-400">Memuatkan...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- SEKSYEN ADUAN -->
    <div id="section-aduan" class="hidden animate-fade-up">
        <div class="flex items-center mb-6">
            <button onclick="showSection('menu', event)" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-600 hover:bg-slate-50 mr-4 transition"><i class="fas fa-arrow-left"></i></button>
            <h2 class="text-xl font-bold text-slate-800">Helpdesk & Aduan</h2>
        </div>

        <div class="bg-white p-1 rounded-xl shadow-sm border border-slate-100 mb-6 flex" id="helpdeskTabs">
            <button id="tab-buat-aduan" class="flex-1 py-2 rounded-lg text-xs font-bold bg-red-600 text-white shadow-sm transition" onclick="switchAduanTab('buat')">HANTAR TIKET</button>
            <button id="tab-semak-aduan" class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-50 transition" onclick="switchAduanTab('semak'); loadTiketUser()">SEJARAH TIKET</button>
        </div>

        <div id="content-buat-aduan">
            <div class="bg-white rounded-3xl shadow-lg border border-slate-100 p-6 md:p-8">
                <form id="formTiket" onsubmit="event.preventDefault(); hantarTiket();" class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PERANAN ANDA</label>
                        <select id="tiketPeranan" class="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none" required>
                            <option value="" disabled selected>- Sila Pilih -</option>
                            <option value="GPICT">GPICT</option>
                            <option value="ADMIN">Pentadbir DELIMa</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">TAJUK MASALAH</label>
                        <input type="text" id="tiketTajuk" class="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none uppercase-input" required oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">BUTIRAN MASALAH</label>
                        <textarea id="tiketMesej" class="w-full p-3 rounded-xl bg-slate-50 border border-slate-200 outline-none h-32" required onblur="this.value = formatSentenceCase(this.value)"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg transition">HANTAR TIKET</button>
                </form>
            </div>
        </div>

        <div id="content-semak-aduan" class="hidden">
            <div id="senaraiTiketContainer" class="space-y-4">
                <div class="text-center py-10 text-slate-400 font-medium">Memuatkan data...</div>
            </div>
        </div>
    </div>

  </div>

  <!-- MODAL EDIT PENYERTAAN -->
  <div id="modalEditPencapaianUser" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/90 backdrop-blur-sm px-4">
      <div class="bg-white w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl max-h-[90vh] overflow-y-auto">
          <div class="bg-teal-600 p-4 flex justify-between items-center text-white sticky top-0 z-10">
              <h3 class="font-bold text-sm">Kemaskini Rekod</h3>
              <button onclick="document.getElementById('modalEditPencapaianUser').classList.add('hidden')" class="hover:bg-teal-700 rounded p-1 text-white">&times;</button>
          </div>
          <div class="p-6">
              <form id="formEditPencapaianUser" onsubmit="event.preventDefault(); updatePencapaianUser();" class="space-y-4">
                  <input type="hidden" id="editUserId">
                  
                  <div class="flex justify-center gap-4 mb-4">
                      <label class="flex items-center gap-2 cursor-pointer">
                          <input type="radio" name="editRadioJenisUser" id="editRadioPertandinganUser" value="PERTANDINGAN" onchange="toggleEditUserJenis()" class="accent-teal-600">
                          <span class="text-xs font-bold">PERTANDINGAN</span>
                      </label>
                      <label class="flex items-center gap-2 cursor-pointer">
                          <input type="radio" name="editRadioJenisUser" id="editRadioPensijilanUser" value="PENSIJILAN" onchange="toggleEditUserJenis()" class="accent-teal-600">
                          <span class="text-xs font-bold">PENSIJILAN</span>
                      </label>
                  </div>

                  <!-- Nama Peserta -->
                  <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">NAMA PESERTA / SEKOLAH</label>
                      <input type="text" id="editUserNama" class="w-full p-3 border border-slate-300 rounded-lg text-sm font-bold uppercase" oninput="this.value = this.value.toUpperCase()" required>
                  </div>
                  
                  <!-- Jawatan -->
                  <div id="editUserDivJawatan" class="hidden">
                      <label class="block text-xs font-bold text-amber-600 uppercase mb-1">JAWATAN (WAJIB)</label>
                      <select id="editUserJawatan" class="w-full p-3 border border-amber-300 bg-amber-50 rounded-lg text-sm font-bold">
                          <!-- Populated by JS -->
                      </select>
                  </div>

                  <!-- Penyedia -->
                  <div id="editUserDivPenyedia" class="hidden">
                      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PENYEDIA / JENAMA</label>
                      <select id="editUserPenyedia" class="w-full p-3 border border-slate-300 rounded-lg text-sm">
                          <!-- Populated by JS -->
                      </select>
                  </div>

                  <!-- Program -->
                  <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="lblEditUserProgram">NAMA PROGRAM</label>
                      <input type="text" id="editUserProgram" class="w-full p-3 border border-slate-300 rounded-lg text-sm font-bold uppercase" oninput="this.value = this.value.toUpperCase()" required>
                  </div>
                  
                  <!-- Peringkat & Tahun -->
                  <div class="grid grid-cols-2 gap-4">
                      <div id="editUserColPeringkat">
                          <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PERINGKAT</label>
                          <select id="editUserPeringkat" class="w-full p-3 border border-slate-300 rounded-lg text-sm">
                              <!-- Populated by JS -->
                          </select>
                      </div>
                      <div id="editUserColTahun">
                          <label class="block text-xs font-bold text-slate-500 uppercase mb-1">TAHUN</label>
                          <div class="relative">
                              <select id="editUserTahun" class="w-full p-3 border border-slate-300 rounded-lg text-sm font-bold appearance-none bg-white outline-none" required>
                                  <!-- Populated by JS -->
                              </select>
                              <i class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none"></i>
                          </div>
                      </div>
                  </div>

                  <!-- Pencapaian -->
                  <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="lblEditUserPencapaian">KEPUTUSAN / PENCAPAIAN</label>
                      <input type="text" id="editUserPencapaian" class="w-full p-3 border border-slate-300 rounded-lg text-sm font-bold uppercase" oninput="this.value = this.value.toUpperCase()" required>
                  </div>

                  <!-- Link -->
                  <div>
                      <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PAUTAN BUKTI (GOOGLE DRIVE)</label>
                      <input type="url" id="editUserLink" class="w-full p-3 border border-slate-300 rounded-lg text-sm text-blue-600" required>
                  </div>

                  <button type="submit" class="w-full mt-4 bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-xl shadow transition">SIMPAN PERUBAHAN</button>
              </form>
          </div>
      </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- MODULAR JS -->
  <script type="module" src="js/user.js"></script>
  
  <script>
      function switchAduanTab(type) {
          const btnBuat = document.getElementById('tab-buat-aduan');
          const btnSemak = document.getElementById('tab-semak-aduan');
          const contentBuat = document.getElementById('content-buat-aduan');
          const contentSemak = document.getElementById('content-semak-aduan');

          if(type === 'buat') {
              btnBuat.className = "flex-1 py-2 rounded-lg text-xs font-bold bg-red-600 text-white shadow-sm transition";
              btnSemak.className = "flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-50 transition";
              contentBuat.classList.remove('hidden');
              contentSemak.classList.add('hidden');
          } else {
              btnSemak.className = "flex-1 py-2 rounded-lg text-xs font-bold bg-slate-800 text-white shadow-sm transition";
              btnBuat.className = "flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-50 transition";
              contentSemak.classList.remove('hidden');
              contentBuat.classList.add('hidden');
          }
      }

      // Hash-based Routing for User Portal (BUG FIX V2.2 - LOCALSTORAGE SYNC)
      document.addEventListener('DOMContentLoaded', () => {
          // UPDATE: Gunakan localStorage untuk konsistensi dengan Admin View
          const userKod = localStorage.getItem('smpid_user_kod');
          const isAuth = localStorage.getItem('smpid_auth') === 'true';

          // Basic security check here for consistency
          if (!userKod && !isAuth) { return; }

          // Listen for hash changes to support browser back/forward buttons
          window.addEventListener('hashchange', () => {
              const hash = window.location.hash.replace('#', '') || 'menu';
              if (['menu', 'profil', 'aduan', 'analisa', 'pencapaian'].includes(hash)) {
                  if (window.showSection) window.showSection(hash);
              }
          });

          // Check initial hash for deep linking
          const initialHash = window.location.hash.replace('#', '') || 'menu';
          if (initialHash !== 'menu') {
              // Delay slightly to ensure js/user.js is fully loaded and initialized
              setTimeout(() => {
                  if (window.showSection) window.showSection(initialHash);
              }, 300);
          }
      });
  </script>

</body>
</html>