<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SMPID - Portal Sekolah</title>
  
  <link rel="icon" href="icoppdag.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body id="page-user">

  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay" class="hidden">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
      <p class="mt-2 fw-bold text-dark">Memuatkan...</p>
    </div>
  </div>

  <!-- HEADER -->
  <div class="header-bg text-center">
    <img src="icoppdag.png" alt="Logo PPD" class="mb-3" style="width: 100px; height: auto;">
    <h3 class="fw-bold px-3">Portal Sekolah</h3>
    <p class="opacity-75 mb-0" id="welcomeText">Selamat Datang</p>
    <div class="mt-3">
        <span class="badge bg-white text-dark shadow-sm px-3 py-2 rounded-pill" id="displayKodSekolah">
            <i class="fas fa-school me-2"></i>Loading...
        </span>
    </div>
  </div>

  <div class="container main-container pb-5">
    <div class="row justify-content-center">
      <div class="col-lg-12 col-xl-10"> 
        
        <!-- SEKSYEN 1: MENU UTAMA (DEFAULT) -->
        <div id="section-menu">
            <div class="row g-4 justify-content-center">
                
                <!-- KAD 1: PROFIL SEKOLAH (col-md-6) -->
                <div class="col-md-6 fade-up" style="animation-delay: 0.1s;">
                    <div class="card menu-card p-4 text-center">
                        <div class="card-body d-flex flex-column">
                            <div class="icon-box icon-school">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h4 class="fw-bold mb-2">Profil Sekolah</h4>
                            <p class="text-muted mb-4 flex-grow-1 small">
                                Kemaskini maklumat Guru Penyelaras ICT (GPICT) dan Admin DELIMa.
                            </p>
                            <button onclick="showSection('profil')" class="btn btn-success btn-menu shadow-sm">
                                <i class="fas fa-user-cog me-2"></i>Kemaskini
                            </button>
                        </div>
                    </div>
                </div>

                <!-- KAD 2: LAPORAN PPPDM (col-md-6) -->
                <div class="col-md-6 fade-up" style="animation-delay: 0.2s;">
                    <div class="card menu-card p-4 text-center border-info">
                        <div class="card-body d-flex flex-column">
                            <div class="icon-box bg-info bg-opacity-10 text-info">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h4 class="fw-bold mb-2">Laporan PPPDM</h4>
                            <p class="text-muted mb-4 flex-grow-1 small">
                                Laporan Pertandingan Program Pemerkasaan Digital Murid.
                            </p>
                            <a href="https://sirsm7.github.io/pppdm" target="_blank" class="btn btn-info text-white btn-menu shadow-sm">
                                <i class="fas fa-file-invoice me-2"></i>Lihat Laporan
                            </a>
                        </div>
                    </div>
                </div>

                <!-- KAD 3: APLIKASI AI (col-md-6) -->
                <div class="col-md-6 fade-up" style="animation-delay: 0.3s;">
                    <div class="card menu-card p-4 text-center">
                        <div class="card-body d-flex flex-column">
                            <div class="icon-box icon-ai">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h4 class="fw-bold mb-2">Aplikasi AI</h4>
                            <p class="text-muted mb-4 flex-grow-1 small">
                                Sistem Pembelajaran Kendiri AI (SPKA) untuk murid.
                            </p>
                            <a href="https://sirsm7.github.io/spka/" target="_blank" class="btn btn-primary btn-menu shadow-sm">
                                <i class="fas fa-external-link-alt me-2"></i>Buka Aplikasi
                            </a>
                        </div>
                    </div>
                </div>

                <!-- KAD 4: BANK SOALAN GEMINI (col-md-6) -->
                <div class="col-md-6 fade-up" style="animation-delay: 0.4s;">
                    <div class="card menu-card p-4 text-center">
                        <div class="card-body d-flex flex-column">
                            <div class="icon-box icon-gemini">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h4 class="fw-bold mb-2">Bank Soalan Gemini</h4>
                            <p class="text-muted mb-4 flex-grow-1 small">
                                Koleksi prompt dan soalan AI untuk rujukan guru.
                            </p>
                            <a href="https://sirsm7.github.io/bankgemini" target="_blank" class="btn btn-outline-primary btn-menu shadow-sm" style="border-color: #6f42c1; color: #6f42c1;">
                                <i class="fas fa-external-link-alt me-2"></i>Akses Bank
                            </a>
                        </div>
                    </div>
                </div>

                <!-- KAD 5: E-ADUAN / TIKET (NEW) -->
                <div class="col-md-12 fade-up" style="animation-delay: 0.5s;">
                    <div class="card menu-card p-4 text-center border-danger">
                        <div class="card-body d-flex flex-column">
                            <div class="icon-box bg-danger bg-opacity-10 text-danger">
                                <i class="fas fa-headset"></i>
                            </div>
                            <h4 class="fw-bold mb-2">e-Aduan & Bantuan</h4>
                            <p class="text-muted mb-4 flex-grow-1 small">
                                Saluran rasmi untuk melaporkan isu teknikal atau masalah DELIMa terus ke PPD.
                            </p>
                            <button onclick="showSection('aduan')" class="btn btn-danger btn-menu shadow-sm">
                                <i class="fas fa-paper-plane me-2"></i>Hantar Tiket
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <div class="text-center mt-5 fade-up" style="animation-delay: 0.6s;">
                <button id="btnLogoutMenu" onclick="keluarSistem()" class="btn btn-link text-danger text-decoration-none fw-bold">
                    <i class="fas fa-sign-out-alt me-2"></i>Log Keluar
                </button>
            </div>
        </div>

        <!-- SEKSYEN 2: PROFIL FORM (HIDDEN) -->
        <div id="section-profil" class="hidden fade-up">
            <div class="card p-4 mx-auto shadow-sm" style="max-width: 800px;">
                <div class="d-flex align-items-center mb-4 pb-3 border-bottom">
                    <button onclick="showSection('menu')" class="btn btn-outline-secondary btn-sm me-3">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div>
                        <h5 class="mb-0 fw-bold" id="dispNamaSekolah">Memuatkan...</h5>
                        <small id="dispKodDaerah" class="text-muted text-uppercase">Sila tunggu sebentar</small>
                    </div>
                </div>
      
                <form id="dataForm" onsubmit="event.preventDefault(); simpanProfil();">
                  <input type="hidden" id="hiddenKodSekolah">
      
                  <h6 class="text-primary pb-2 mb-3 mt-2"><i class="fas fa-user-tie me-2"></i>MAKLUMAT GPICT</h6>
                  <div class="row g-3">
                      <div class="col-12">
                        <label class="form-label fw-bold small text-muted">NAMA PENUH</label>
                        <input type="text" class="form-control uppercase-input bg-light" id="gpictNama" required oninput="this.value = this.value.toUpperCase()">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">NO. TELEFON</label>
                        <input type="tel" class="form-control bg-light" id="gpictTel" required placeholder="0123456789" onblur="autoFormatPhone(this)">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">EMEL DELIMA (@moe-dl.edu.my)</label>
                        <input type="email" class="form-control bg-light" id="gpictEmel" required placeholder="g-xxxxxxxx@moe-dl.edu.my">
                      </div>
                  </div>
      
                  <div class="d-flex justify-content-between align-items-center pb-2 mb-3 mt-5">
                    <h6 class="text-primary mb-0"><i class="fas fa-user-shield me-2"></i>MAKLUMAT ADMIN DELIMA</h6>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="checkSama" onchange="salinData()">
                      <label class="form-check-label small fw-bold text-muted" for="checkSama">Sama dengan GPICT</label>
                    </div>
                  </div>
                  
                  <div class="row g-3">
                      <div class="col-12">
                        <label class="form-label fw-bold small text-muted">NAMA PENUH</label>
                        <input type="text" class="form-control uppercase-input bg-light" id="adminNama" required oninput="this.value = this.value.toUpperCase()">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">NO. TELEFON</label>
                        <input type="tel" class="form-control bg-light" id="adminTel" required placeholder="0123456789" onblur="autoFormatPhone(this)">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">EMEL DELIMA (@moe-dl.edu.my)</label>
                        <input type="email" class="form-control bg-light" id="adminEmel" required placeholder="g-xxxxxxxx@moe-dl.edu.my">
                      </div>
                  </div>
      
                  <div class="d-grid gap-2 mt-5">
                    <button type="submit" class="btn btn-success btn-lg fw-bold shadow">
                      <i class="fas fa-save me-2"></i>KEMASKINI DATA
                    </button>
                    
                    <button type="button" id="btnResetData" onclick="resetDataSekolah()" class="btn btn-danger hidden">
                        <i class="fas fa-trash-restore me-2"></i>RESET DATA SEKOLAH (ADMIN)
                    </button>

                    <button type="button" onclick="showSection('menu')" class="btn btn-light text-muted">
                        Batal
                    </button>
                  </div>
                </form>
              </div>
        </div>

        <!-- SEKSYEN 3: ADUAN / TIKET FORM (NEW - HIDDEN) -->
        <div id="section-aduan" class="hidden fade-up">
            <div class="card p-4 mx-auto shadow-sm" style="max-width: 800px;">
                <div class="d-flex align-items-center mb-4 pb-3 border-bottom">
                    <button onclick="showSection('menu')" class="btn btn-outline-secondary btn-sm me-3">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div>
                        <h5 class="mb-0 fw-bold">Sistem Tiket & Aduan</h5>
                        <small class="text-muted">Laporkan isu terus kepada PPD</small>
                    </div>
                </div>

                <div class="row g-4">
                    <!-- Kolum Kiri: Borang -->
                    <div class="col-md-12">
                        <div class="bg-light p-3 rounded border mb-4">
                            <h6 class="text-danger fw-bold mb-3"><i class="fas fa-edit me-2"></i>Buka Tiket Baru</h6>
                            <form id="formTiket" onsubmit="event.preventDefault(); hantarTiket();">
                                <div class="mb-3">
                                    <label class="form-label small fw-bold text-muted">IDENTITI PENGIRIM</label>
                                    <select class="form-select" id="tiketPeranan" required>
                                        <option value="" selected disabled>-- Sila Pilih Jawatan Anda --</option>
                                        <option value="GPICT">Guru Penyelaras ICT (GPICT)</option>
                                        <option value="ADMIN">Admin DELIMa</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold text-muted">TAJUK ISU</label>
                                    <input type="text" class="form-control" id="tiketTajuk" placeholder="Cth: Lupa Kata Laluan Admin" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold text-muted">BUTIRAN MESEJ</label>
                                    <textarea class="form-control" id="tiketMesej" rows="4" placeholder="Jelaskan masalah dengan ringkas..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-danger w-100 fw-bold">
                                    <i class="fas fa-paper-plane me-2"></i>Hantar Tiket
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Kolum Bawah: Sejarah -->
                    <div class="col-md-12">
                        <h6 class="fw-bold text-dark mb-3"><i class="fas fa-history me-2"></i>Sejarah Tiket Anda</h6>
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover small">
                                <thead class="table-light">
                                    <tr>
                                        <th>Tarikh</th>
                                        <th>Pengirim</th>
                                        <th>Tajuk</th>
                                        <th>Status</th>
                                        <th>Tindakan PPD</th>
                                    </tr>
                                </thead>
                                <tbody id="senaraiTiketUser">
                                    <tr><td colspan="5" class="text-center text-muted">Memuatkan rekod...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>

      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>