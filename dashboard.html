<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SMPID - Dashboard Admin</title>
  
  <link rel="icon" href="icoppdag.png">
  <!-- CSS Library -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS Custom (Pastikan file style.css wujud dalam folder css) -->
  <link href="css/style.css" rel="stylesheet">
  
  <!-- JS Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay" class="hidden">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
      <p class="mt-2 fw-bold text-dark">Sedang Memproses...</p>
    </div>
  </div>

  <!-- QUEUE MODAL (Popup Tindakan Pantas) -->
  <div id="queueModal" class="queue-overlay hidden">
      <div class="queue-card shadow-lg">
          <button class="btn-close-queue" onclick="document.getElementById('queueModal').classList.add('hidden')" title="Tutup tetingkap">&times;</button>
          
          <div class="queue-progress fw-bold text-muted mb-3" id="qProgress">Sasaran 0 / 0</div>
          <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill" id="qRoleBadge">ROLE</span>
          
          <h4 class="queue-school fw-bold mb-1 text-dark" id="qSchoolName">NAMA SEKOLAH</h4>
          <p class="text-muted small mb-3" id="qCode">KOD SEKOLAH</p>
          <hr class="w-50 mx-auto opacity-25">
          <h5 class="queue-person text-success fw-bold mb-4" id="qPersonName">NAMA GURU</h5>
          
          <div class="alert alert-light border small text-start mb-3 bg-light">
              <i class="fas fa-info-circle me-1 text-primary"></i> 
              Klik butang WhatsApp di bawah untuk menghantar peringatan pendaftaran bot.
          </div>

          <a href="#" id="qWaBtn" target="_blank" class="btn-wa-big shadow-sm" onclick="setTimeout(nextQueue, 2000)">
              <i class="fab fa-whatsapp fa-lg"></i> Buka WhatsApp & Hantar
          </a>
          
          <div class="d-flex gap-2 justify-content-center mt-3">
            <button class="btn btn-light border w-50 fw-bold" onclick="prevQueue()">
                <i class="fas fa-chevron-left me-1"></i> Sebelum
            </button>
            <button class="btn btn-light border w-50 fw-bold" onclick="nextQueue()">
                Seterusnya <i class="fas fa-chevron-right ms-1"></i>
            </button>
          </div>
      </div>
  </div>

  <!-- HEADER UTAMA -->
  <div class="header-bg text-center">
    <img src="icoppdag.png" alt="Logo PPD" class="mb-4" style="width: 180px; height: auto; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">
    <h2 class="fw-bold px-3 text-white"><i class="fas fa-school me-2"></i>Dashboard Admin</h2>
    <p class="text-white opacity-75">Unit Sumber Teknologi Pendidikan, PPD Alor Gajah</p>
  </div>

  <!-- KANDUNGAN DASHBOARD -->
  <div class="container main-container pb-5">
    <div class="row justify-content-center">
      <div class="col-md-12">

        <div id="dashboardCard" class="card p-4 shadow-sm bg-white">
          <!-- Baris Atas: Tajuk & Butang Aksi -->
          <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 border-bottom pb-3 gap-3">
            <div>
                 <h4 class="mb-1 fw-bold text-primary"><i class="fas fa-tachometer-alt me-2"></i>Status Pendaftaran</h4>
                 <small class="text-muted">Pantau status pengisian data sekolah dan pendaftaran Bot Telegram.</small>
            </div>
            
            <div class="d-flex gap-2 flex-wrap">
              <!-- Butang Tindakan Pantas -->
              <button onclick="mulaTindakanPantas()" class="btn btn-success btn-sm fw-bold shadow-sm px-3">
                <i class="fab fa-whatsapp me-2"></i>Tindakan Pantas
              </button>
              
              <!-- Butang List Telegram (Yang sebelum ini rosak) -->
              <button onclick="janaSenaraiTelegram()" class="btn btn-primary btn-sm fw-bold shadow-sm px-3">
                <i class="fab fa-telegram-plane me-2"></i>Salin Senarai Belum Isi
              </button>
              
              <!-- Butang Keluar -->
              <button onclick="keluarSistem()" class="btn btn-outline-danger btn-sm fw-bold px-3">
                <i class="fas fa-sign-out-alt me-2"></i>Keluar
              </button>
            </div>
          </div>

          <!-- Bahagian Filter -->
          <div class="mb-4" id="filterContainer">
             <!-- Kandungan Filter dijana oleh JS -->
             <div class="placeholder-glow">
                 <span class="placeholder col-12 bg-secondary rounded py-3"></span>
             </div>
          </div>
          
          <!-- Grid Sekolah -->
          <div id="schoolGridWrapper">
             <!-- Kandungan Grid dijana oleh JS -->
          </div>

        </div>

      </div>
    </div>
  </div>

  <!-- Script Luaran -->
  <script src="js/utils.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>